# ğŸ”“ TP SÃ©curitÃ© Web - API de DÃ©monstration

> **âš ï¸ ATTENTION** : Cette application contient volontairement des vulnÃ©rabilitÃ©s Ã  des fins pÃ©dagogiques uniquement !

Bienvenue dans la documentation complÃ¨te du **TP SÃ©curitÃ© Web**, une API Express hÃ©bergÃ©e sur **Azure VM** avec **HTTPS/Let's Encrypt** pour dÃ©montrer les principales vulnÃ©rabilitÃ©s web et leurs remÃ©diations.

## ğŸŒ API HÃ©bergÃ©e sur Azure

<div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
  <h3 className="text-blue-800 font-semibold">ğŸ”— AccÃ¨s Direct Ã  l'API</h3>
  <div className="mt-3 space-y-3">
    <div className="flex items-center space-x-2">
      <span className="text-green-600">ğŸ”’</span>
      <strong>API Principale :</strong>
      <a href="https://tp-securite-khelifa.francecentral.cloudapp.azure.com" className="text-blue-600 hover:underline">
        https://tp-securite-khelifa.francecentral.cloudapp.azure.com
      </a>
    </div>
    <div className="flex items-center space-x-2">
      <span className="text-blue-600">ğŸ“š</span>
      <strong>Documentation Interactive Swagger :</strong>
      <a href="https://tp-securite-khelifa.francecentral.cloudapp.azure.com/api" className="text-blue-600 hover:underline">
        /api
      </a>
    </div>
    <div className="flex items-center space-x-2">
      <span className="text-gray-600">â„¹ï¸</span>
      <span className="text-sm text-gray-600">HTTPS sÃ©curisÃ© avec certificat Let's Encrypt</span>
    </div>
  </div>
</div>

## ğŸ¯ Comment Utiliser ce TP

### ğŸ“± Interface Swagger RecommandÃ©e

L'interface Swagger UI est la mÃ©thode la plus simple pour tester les vulnÃ©rabilitÃ©s :

1. **AccÃ©dez Ã  :** [https://tp-securite-khelifa.francecentral.cloudapp.azure.com/api](https://tp-securite-khelifa.francecentral.cloudapp.azure.com/api)
2. **CrÃ©ez un utilisateur** avec `/create-user`
3. **Testez les vulnÃ©rabilitÃ©s** (section `ğŸš¨ Endpoints vulnÃ©rables`)
4. **VÃ©rifiez les protections** (section `ğŸ›¡ï¸ Versions sÃ©curisÃ©es`)

<div className="bg-green-50 border border-green-200 rounded-lg p-4 mt-3">
  <h4 className="text-green-800 font-semibold">âœ¨ Pourquoi Swagger UI ?</h4>
  <ul className="mt-2 text-green-700 space-y-1">
    <li>â€¢ <strong>Interface graphique</strong> - Pas de ligne de commande</li>
    <li>â€¢ <strong>Exemples intÃ©grÃ©s</strong> - Payloads prÃªts Ã  tester</li>
    <li>â€¢ <strong>RÃ©ponses formatÃ©es</strong> - JSON colorÃ© et lisible</li>
    <li>â€¢ <strong>Un clic = un test</strong> - Execution immÃ©diate</li>
  </ul>
</div>

---

# ğŸš¨ VULNÃ‰RABILITÃ‰S Ã‰TUDIÃ‰ES

## 1. ğŸ—ƒï¸ NoSQL Injection

### Qu'est-ce que c'est ?
L'injection NoSQL permet de manipuler les requÃªtes MongoDB en injectant des objets JavaScript malveillants au lieu de simples chaÃ®nes de caractÃ¨res.

### Comment tester avec Swagger ?

**Ã‰tape 1 :** Allez sur `/vulnerable/login` dans Swagger
**Ã‰tape 2 :** Cliquez sur `Try it out`
**Ã‰tape 3 :** Utilisez ce payload pour bypasser l'authentification :

```json
{
  "username": {"$ne": null},
  "password": {"$ne": null}
}
```

**RÃ©sultat :** Connexion rÃ©ussie sans connaÃ®tre les vrais identifiants !

### Pourquoi Ã§a marche ?

Le code vulnÃ©rable accepte directement les objets :
```javascript
// âŒ VULNÃ‰RABLE
const user = await User.findOne({ 
  username: username,    // Peut Ãªtre un objet !
  password: password     // {"$ne": null} = "diffÃ©rent de null"
});
```

### Comment se protÃ©ger ?

**Testez sur `/secure/login` :** Le mÃªme payload sera rejetÃ© avec "Types de donnÃ©es invalides"

```javascript
// âœ… SÃ‰CURISÃ‰
if (typeof username !== 'string' || typeof password !== 'string') {
  return res.status(400).json({ error: 'Types invalides' });
}
```

---

## 2. ğŸ“ Local File Inclusion (LFI)

### Qu'est-ce que c'est ?
La LFI permet de lire des fichiers arbitraires sur le serveur en exploitant les paramÃ¨tres de chemin de fichier.

### Comment tester avec Swagger ?

**Ã‰tape 1 :** Allez sur `/vulnerable/file` dans Swagger
**Ã‰tape 2 :** Testez ces diffÃ©rents fichiers :

| Fichier Ã  tester | RÃ©sultat attendu |
|-----------------|------------------|
| `public.txt` | âœ… Fichier normal (autorisÃ©) |
| `secret.txt` | âš ï¸ Fichier secret exposÃ© |
| `config.txt` | ğŸš¨ Fichiers Configuration sensible |

### Pourquoi Ã§a marche ?

Le code vulnÃ©rable ne valide pas les chemins :
```javascript
// âŒ VULNÃ‰RABLE
const filePath = path.join('./demo-files', file);
const content = fs.readFileSync(filePath, 'utf8');
```

### Comment se protÃ©ger ?

**Testez sur `/secure/file` :** Seul `public.txt` sera autorisÃ©

```javascript
// âœ… SÃ‰CURISÃ‰
const ALLOWED_FILES = ['public.txt'];
if (!ALLOWED_FILES.includes(file)) {
  return res.status(403).json({ error: 'Fichier non autorisÃ©' });
}
```

---

## 3. ğŸ”‘ JWT VulnÃ©rable

### Qu'est-ce que c'est ?
Les vulnÃ©rabilitÃ©s JWT incluent les secrets faibles et l'acceptation de l'algorithme "none" qui supprime la signature.

### Comment tester avec Swagger ?

**Ã‰tape 1 :** GÃ©nÃ©rez un token sur `/vulnerable/jwt-login`
```json
{
  "username": "admin",
  "password": "secret123"
}
```

**Ã‰tape 2 :** Testez un token sans signature sur `/vulnerable/jwt-verify`
```json
{
  "token": "eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIn0."
}
```

**RÃ©sultat :** Token acceptÃ© sans vÃ©rification de signature !

### Analyse du token

Copiez le token gÃ©nÃ©rÃ© et analysez-le sur [jwt.io](https://jwt.io) :
- **Secret faible :** "secret" (facilement bruteforcÃ©)
- **Algorithme :** Peut Ãªtre modifiÃ© en "none"

### Comment se protÃ©ger ?

**Testez sur `/secure/jwt-verify` :** Le token "none" sera rejetÃ©

```javascript
// âœ… SÃ‰CURISÃ‰
const decoded = jwt.verify(token, STRONG_SECRET, { 
  algorithms: ['HS256']  // HS256 uniquement !
});
```

---

# ğŸ“Š TABLEAU COMPARATIF

| VulnÃ©rabilitÃ© | Endpoint VulnÃ©rable | Test Rapide | Endpoint SÃ©curisÃ© | Protection |
|---------------|-------------------|-------------|------------------|------------|
| **NoSQL Injection** | `/vulnerable/login` | `{"username":{"$ne":null}}` | `/secure/login` | Validation des types |
| **LFI** | `/vulnerable/file` | `?file=../../../etc/passwd` | `/secure/file` | Whitelist de fichiers |
| **JWT** | `/vulnerable/jwt-verify` | Token avec `"alg":"none"` | `/secure/jwt-verify` | Algorithme strict |

---

# ğŸ›¡ï¸ BONNES PRATIQUES APPRISES

## âœ… RÃ¨gles d'Or de la SÃ©curitÃ©

1. **Validation stricte** : VÃ©rifiez TOUJOURS les types de donnÃ©es
2. **Principe de moindre privilÃ¨ge** : N'autorisez que le minimum nÃ©cessaire  
3. **Defense in depth** : Plusieurs couches de protection
4. **Fail secure** : En cas d'erreur, privilÃ©giez la sÃ©curitÃ©

## ğŸ”§ Techniques de Protection

### NoSQL
- Validation des types (`typeof === 'string'`)
- Sanitisation des entrÃ©es
- Utilisation de requÃªtes paramÃ©trÃ©es

### LFI  
- Whitelist des fichiers autorisÃ©s
- Validation des chemins
- Blocage des caractÃ¨res de traversal (`../`)

### JWT
- Secrets cryptographiquement forts (256+ bits)
- Algorithmes spÃ©cifiques (`HS256` uniquement)
- Validation complÃ¨te (issuer, audience, expiration)

---

# âš ï¸ AVERTISSEMENT Ã‰THIQUE

<div className="bg-red-50 border border-red-200 rounded-lg p-4 mt-6">
  <h3 className="text-red-800 font-semibold">ğŸš¨ Utilisation Responsable Uniquement</h3>
  <div className="mt-2 text-red-700">
    <p><strong>âœ… AutorisÃ© :</strong></p>
    <ul className="list-disc list-inside mt-1">
      <li>Tests sur cette API de dÃ©monstration</li>
      <li>Apprentissage en laboratoire contrÃ´lÃ©</li>
      <li>Formation en cybersÃ©curitÃ©</li>
    </ul>
    
    <p className="mt-3"><strong>âŒ Strictement Interdit :</strong></p>
    <ul className="list-disc list-inside mt-1">
      <li>Tests sur des systÃ¨mes sans autorisation Ã©crite</li>
      <li>Utilisation malveillante ou illÃ©gale</li>
      <li>Attaques contre des infrastructures rÃ©elles</li>
    </ul>
    
    <p className="mt-3 text-sm">
      <strong>Rappel lÃ©gal :</strong> Le piratage informatique sans autorisation est un dÃ©lit passible d'amendes et d'emprisonnement.
    </p>
  </div>
</div>

---

<div className="text-center mt-8">
  <div className="space-y-4">
    <h2 className="text-2xl font-bold text-gray-800">
      ğŸ“ Formation ComplÃ¨te en SÃ©curitÃ© Web
    </h2>
    <p className="text-gray-600">
      API hÃ©bergÃ©e sur Azure â€¢ HTTPS sÃ©curisÃ© â€¢ Interface Swagger interactive
    </p>
    <div className="space-x-4">
      <a href="https://tp-securite-khelifa.francecentral.cloudapp.azure.com/api" className="bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition-colors inline-block text-lg font-semibold">
        ğŸš€ Commencer les Tests sur Swagger
      </a>
    </div>
    <p className="text-sm text-gray-500 mt-4">
      PrÃªt en 30 secondes â€¢ Aucune installation requise â€¢ Tests interactifs
    </p>
  </div>
</div>